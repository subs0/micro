{
    "terraform": {
        "required_providers": {
            "aws": {
                "source": "hashicorp/aws",
                "version": "5.20.0"
            }
        }
    },
    "provider": [
        {
            "aws": {
                "region": "us-east-2",
                "profile": "chopshop"
            }
        }
    ],
    "data": {
        "aws_iam_policy_document": {
            "my_module1_lambda_policy_doc": {
                "statement": {
                    "effect": "Allow",
                    "actions": [
                        "sts:AssumeRole"
                    ],
                    "principals": {
                        "identifiers": [
                            "lambda.amazonaws.com"
                        ],
                        "type": "Service"
                    }
                }
            }
        }
    },
    "resource": {
        "aws_sns_topic": {
            "my_module1_topic": {
                "name": "bloop-topic"
            }
        },
        "aws_efs_file_system": {
            "my_module1_efs": {
                "tags": {
                    "Source": "Micro"
                }
            }
        },
        "aws_s3_bucket": {
            "my_module1_s3": {
                "bucket": "bloop"
            }
        },
        "aws_iam_role": {
            "my_module1_lambda_role": {
                "name": "bloop-role",
                "assume_role_policy": "${data.aws_iam_policy_document.my_module1_lambda_policy_doc.json}"
            }
        },
        "aws_lambda_function": {
            "my_module1_lambda": {
                "function_name": "lambda_efs-bloop",
                "role": "${resource.aws_iam_role.my_module1_lambda_role.arn}",
                "runtime": "python3.8",
                "handler": "handler.handler",
                "filename": "${path.root}/lambdas/template/zipped/handler.py.zip",
                "file_system_config": {
                    "arn": "${resource.aws_efs_file_system.my_module1_efs.arn}",
                    "local_mount_path": "/mnt/efs"
                },
                "environment": {
                    "variables": {
                        "S3_BUCKET_NAME": "bloop",
                        "SNS_TOPIC_ARN": "${resource.aws_sns_topic.my_module1_topic.arn}"
                    }
                }
            }
        },
        "aws_sns_topic_subscription": {
            "my_module1_subscription": {
                "topic_arn": "${resource.aws_sns_topic.my_module1_topic.arn}",
                "protocol": "lambda",
                "endpoint": "${resource.aws_lambda_function.my_module1_lambda.arn}",
                "filter_policy": "{}",
                "filter_policy_scope": "MessageAttributes"
            }
        }
    }
}