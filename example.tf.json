{
    "data": {
        "aws_route53_zone": {
            "example_zone_zone": {
                "name": "chopshop-test.net"
            }
        },
        "external": {
            "example_build_prepare": {
                "program": [
                    "${(substr(pathexpand(\"~\"), 0, 1) == \"/\") ? \"python3\" : \"python.exe\"}",
                    "${path.root}/src/utils/package.py",
                    "prepare"
                ],
                "query": {
                    "paths": "{\"module\":\"${path.module}\",\"root\":\"${path.root}\",\"cwd\":\"${path.cwd}\"}",
                    "artifacts_dir": "builds",
                    "runtime": "python3.11",
                    "source_path": "${path.root}/throwaway/ML/lambdas/multipart_upload",
                    "hash_extra": "",
                    "hash_extra_paths": "[]",
                    "recreate_missing_package": true
                }
            }
        },
        "aws_iam_policy_document": {
            "example_lambda_policy_doc": {
                "statement": {
                    "effect": "Allow",
                    "actions": [
                        "sts:AssumeRole"
                    ],
                    "principals": {
                        "identifiers": [
                            "lambda.amazonaws.com",
                            "apigateway.amazonaws.com"
                        ],
                        "type": "Service"
                    }
                }
            },
            "example_lambda_bucket_access_creds": {
                "statement": [
                    {
                        "principals": {
                            "identifiers": [
                                "${resource.aws_iam_role.example_lambda_role.arn}"
                            ],
                            "type": "AWS"
                        },
                        "effect": "Allow",
                        "actions": [
                            "s3:AbortMultipartUpload",
                            "s3:ListMultipartUploadParts",
                            "s3:ListBucketMultipartUploads",
                            "s3:PutObject",
                            "s3:GetObject",
                            "s3:DeleteObject"
                        ],
                        "resources": [
                            "arn:aws:s3:::${resource.aws_s3_bucket.example_lambda_bucket.bucket}",
                            "arn:aws:s3:::${resource.aws_s3_bucket.example_lambda_bucket.bucket}/*"
                        ]
                    }
                ]
            },
            "example_lambda_access_creds": {
                "statement": [
                    {
                        "effect": "Allow",
                        "actions": [
                            "s3:AbortMultipartUpload",
                            "s3:ListMultipartUploadParts",
                            "s3:ListBucketMultipartUploads",
                            "s3:PutObject",
                            "s3:GetObject",
                            "s3:DeleteObject"
                        ],
                        "resources": [
                            "arn:aws:s3:::${resource.aws_s3_bucket.example_lambda_bucket.bucket}",
                            "arn:aws:s3:::${resource.aws_s3_bucket.example_lambda_bucket.bucket}/*"
                        ]
                    },
                    {
                        "effect": "Allow",
                        "actions": [
                            "sns:Publish",
                            "sns:Subscribe"
                        ],
                        "resources": [
                            "${resource.aws_sns_topic.example_topic_sns.arn}"
                        ]
                    },
                    {
                        "effect": "Allow",
                        "actions": [
                            "logs:CreateLogGroup",
                            "logs:CreateLogStream",
                            "logs:PutLogEvents"
                        ],
                        "resources": [
                            "${resource.aws_cloudwatch_log_group.example_lambda_cloudwatch.arn}:*",
                            "${resource.aws_cloudwatch_log_group.example_lambda_cloudwatch.arn}:*:*"
                        ]
                    }
                ]
            }
        }
    },
    "resource": {
        "aws_sns_topic": {
            "example_topic_sns": {
                "name": "throwaway-test-123-topic",
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                }
            }
        },
        "local_file": {
            "example_build_archive_plan": {
                "content": "${data.external.example_build_prepare.result.build_plan}",
                "filename": "${data.external.example_build_prepare.result.build_plan_filename}",
                "directory_permission": "0755",
                "file_permission": "0644"
            }
        },
        "null_resource": {
            "example_build_archive": {
                "triggers": {
                    "filename": "${data.external.example_build_prepare.result.filename}",
                    "timestamp": "${data.external.example_build_prepare.result.timestamp}"
                },
                "provisioner": {
                    "local-exec": {
                        "interpreter": [
                            "${(substr(pathexpand(\"~\"), 0, 1) == \"/\") ? \"python3\" : \"python.exe\"}",
                            "${path.root}/src/utils/package.py",
                            "build",
                            "--timestamp",
                            "${data.external.example_build_prepare.result.timestamp}"
                        ],
                        "command": "${data.external.example_build_prepare.result.build_plan_filename}"
                    }
                },
                "depends_on": [
                    "local_file.example_build_archive_plan"
                ]
            }
        },
        "aws_iam_role": {
            "example_lambda_role": {
                "name": "throwaway-test-123-role",
                "assume_role_policy": "${data.aws_iam_policy_document.example_lambda_policy_doc.json}",
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                }
            }
        },
        "aws_s3_bucket": {
            "example_lambda_bucket": {
                "bucket": "throwaway-test-123-bucket",
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                }
            }
        },
        "aws_s3_bucket_cors_configuration": {
            "example_lambda_bucket_cors": {
                "bucket": "${resource.aws_s3_bucket.example_lambda_bucket.bucket}",
                "cors_rule": {
                    "allowed_methods": [
                        "POST",
                        "GET",
                        "HEAD",
                        "DELETE",
                        "PUT"
                    ],
                    "allowed_origins": [
                        "*"
                    ],
                    "allowed_headers": [
                        "*"
                    ],
                    "expose_headers": [
                        "ETag"
                    ],
                    "max_age_seconds": 3000
                }
            }
        },
        "aws_s3_bucket_policy": {
            "example_lambda_bucket_policy": {
                "bucket": "${resource.aws_s3_bucket.example_lambda_bucket.bucket}",
                "policy": "${data.aws_iam_policy_document.example_lambda_bucket_access_creds.json}"
            }
        },
        "aws_cloudwatch_log_group": {
            "example_lambda_cloudwatch": {
                "name": "/aws/function/throwaway-test-123-log-group",
                "retention_in_days": 7,
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                }
            }
        },
        "aws_iam_policy": {
            "example_lambda_policy": {
                "name": "throwaway-test-123-policy-policy",
                "policy": "${data.aws_iam_policy_document.example_lambda_access_creds.json}",
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                }
            }
        },
        "aws_iam_role_policy_attachment": {
            "example_lambda_policy_attachment": {
                "role": "${resource.aws_iam_role.example_lambda_role.name}",
                "policy_arn": "${resource.aws_iam_policy.example_lambda_policy.arn}"
            }
        },
        "aws_lambda_function": {
            "example_lambda_function": {
                "package_type": "Zip",
                "filename": "${data.external.example_build_prepare.result.filename}",
                "handler": "index.handler",
                "runtime": "python3.11",
                "function_name": "function-throwaway-test-123",
                "memory_size": 512,
                "timeout": 60,
                "role": "${resource.aws_iam_role.example_lambda_role.arn}",
                "environment": {
                    "variables": {
                        "S3_BUCKET_NAME": "${resource.aws_s3_bucket.example_lambda_bucket.bucket}",
                        "SNS_TOPIC_ARN": "${resource.aws_sns_topic.example_topic_sns.arn}",
                        "SNS_MESSAGE_ATTRS": "{\"type\":{\"DataType\":\"String\",\"StringValue\":\"audio\"}}"
                    }
                },
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                },
                "depends_on": [
                    "null_resource.example_build_archive"
                ]
            }
        },
        "aws_lambda_permission": {
            "example_lambda_sns_invoke_cred": {
                "statement_id": "AllowExecutionFromSNS",
                "action": "lambda:InvokeFunction",
                "function_name": "${resource.aws_lambda_function.example_lambda_function.function_name}",
                "principal": "sns.amazonaws.com",
                "source_arn": "${resource.aws_sns_topic.example_topic_sns.arn}"
            },
            "example_api_invoker_test1_ANY": {
                "statement_id": "AllowExecutionFromAPIGateway",
                "action": "lambda:InvokeFunction",
                "function_name": "${resource.aws_lambda_function.example_lambda_function.arn}",
                "principal": "apigateway.amazonaws.com",
                "source_arn": "${resource.aws_apigatewayv2_api.example_api_apigw_test1.execution_arn}/*/*"
            }
        },
        "aws_sns_topic_subscription": {
            "example_lambda_subscription": {
                "topic_arn": "${resource.aws_sns_topic.example_topic_sns.arn}",
                "protocol": "lambda",
                "endpoint": "${resource.aws_lambda_function.example_lambda_function.arn}",
                "filter_policy": "{\"type\":[\"video\"]}",
                "filter_policy_scope": "MessageAttributes"
            }
        },
        "aws_acm_certificate": {
            "example_api_cert_test1": {
                "domain_name": "test1.chopshop-test.net",
                "validation_method": "DNS",
                "lifecycle": {
                    "create_before_destroy": true
                },
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                }
            }
        },
        "aws_acm_certificate_validation": {
            "example_api_validation_test1": {
                "certificate_arn": "${resource.aws_acm_certificate.example_api_cert_test1.arn}",
                "validation_record_fqdns": [
                    "${resource.aws_route53_record.example_api_record_valid_test1.fqdn}"
                ]
            }
        },
        "aws_apigatewayv2_domain_name": {
            "example_api_domain_test1": {
                "domain_name": "test1.chopshop-test.net",
                "domain_name_configuration": [
                    {
                        "certificate_arn": "${resource.aws_acm_certificate_validation.example_api_validation_test1.certificate_arn}",
                        "endpoint_type": "REGIONAL",
                        "security_policy": "TLS_1_2"
                    }
                ],
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                }
            }
        },
        "aws_route53_record": {
            "example_api_record_test1": {
                "name": "test1.chopshop-test.net",
                "type": "A",
                "zone_id": "${data.aws_route53_zone.example_zone_zone.zone_id}",
                "allow_overwrite": true,
                "alias": {
                    "name": "${resource.aws_apigatewayv2_domain_name.example_api_domain_test1.domain_name_configuration[0].target_domain_name}",
                    "zone_id": "${resource.aws_apigatewayv2_domain_name.example_api_domain_test1.domain_name_configuration[0].hosted_zone_id}",
                    "evaluate_target_health": false
                }
            },
            "example_api_record_valid_test1": {
                "name": "${one(resource.aws_acm_certificate.example_api_cert_test1.domain_validation_options).resource_record_name}",
                "type": "${one(resource.aws_acm_certificate.example_api_cert_test1.domain_validation_options).resource_record_type}",
                "zone_id": "${data.aws_route53_zone.example_zone_zone.zone_id}",
                "allow_overwrite": true,
                "records": [
                    "${one(resource.aws_acm_certificate.example_api_cert_test1.domain_validation_options).resource_record_value}"
                ],
                "ttl": 60
            }
        },
        "aws_apigatewayv2_api": {
            "example_api_apigw_test1": {
                "name": "test1.chopshop-test.net",
                "description": "api for test1.chopshop-test.net",
                "disable_execute_api_endpoint": false,
                "protocol_type": "HTTP",
                "cors_configuration": {
                    "allow_headers": [
                        "content-type",
                        "x-amz-date",
                        "authorization",
                        "x-api-key",
                        "x-amz-security-token",
                        "x-amz-user-agent"
                    ],
                    "allow_methods": [
                        "*"
                    ],
                    "allow_origins": [
                        "*"
                    ],
                    "max_age": 300
                },
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                }
            }
        },
        "aws_apigatewayv2_stage": {
            "example_api_stage_test1": {
                "api_id": "${resource.aws_apigatewayv2_api.example_api_apigw_test1.id}",
                "name": "$default",
                "auto_deploy": true,
                "description": "stage $default API",
                "tags": {
                    "BroughtToYouBy": "@-0/micro",
                    "Moms": "Spaghetti"
                }
            }
        },
        "aws_apigatewayv2_integration": {
            "example_api_integration_test1_ANY": {
                "api_id": "${resource.aws_apigatewayv2_api.example_api_apigw_test1.id}",
                "description": "lambda integration",
                "integration_uri": "${resource.aws_lambda_function.example_lambda_function.invoke_arn}",
                "integration_type": "AWS_PROXY",
                "integration_method": "POST",
                "connection_type": "INTERNET",
                "payload_format_version": "2.0",
                "timeout_milliseconds": 29000
            }
        },
        "aws_apigatewayv2_route": {
            "example_api_route_test1_ANY": {
                "api_id": "${resource.aws_apigatewayv2_api.example_api_apigw_test1.id}",
                "route_key": "ANY /",
                "target": "integrations/${resource.aws_apigatewayv2_integration.example_api_integration_test1_ANY.id}"
            }
        }
    },
    "provider": [
        {
            "aws": {
                "region": "us-east-2",
                "profile": "chopshop"
            }
        }
    ],
    "terraform": {
        "required_providers": {
            "aws": {
                "source": "hashicorp/aws",
                "version": ">= 5.20"
            },
            "docker": {
                "source": "kreuzwerker/docker",
                "version": ">= 3.0"
            },
            "null": {
                "source": "hashicorp/null",
                "version": ">= 2.0"
            }
        }
    }
}