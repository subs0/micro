{
  "data": {
    "type": "provider-docs",
    "id": "3197920",
    "attributes": {
      "category": "resources",
      "content": "---\nsubcategory: \"Amplify\"\nlayout: \"aws\"\npage_title: \"AWS: aws_amplify_branch\"\ndescription: |-\n  Provides an Amplify Branch resource.\n---\n\n# Resource: aws_amplify_branch\n\nProvides an Amplify Branch resource.\n\n## Example Usage\n\n```terraform\nresource \"aws_amplify_app\" \"example\" {\n  name = \"app\"\n}\n\nresource \"aws_amplify_branch\" \"master\" {\n  app_id      = aws_amplify_app.example.id\n  branch_name = \"master\"\n\n  framework = \"React\"\n  stage     = \"PRODUCTION\"\n\n  environment_variables = {\n    REACT_APP_API_SERVER = \"https://api.example.com\"\n  }\n}\n```\n\n### Basic Authentication\n\n```terraform\nresource \"aws_amplify_app\" \"example\" {\n  name = \"app\"\n}\n\nresource \"aws_amplify_branch\" \"master\" {\n  app_id      = aws_amplify_app.example.id\n  branch_name = \"master\"\n\n  enable_basic_auth      = true\n  basic_auth_credentials = base64encode(\"username:password\")\n}\n```\n\n### Notifications\n\nAmplify Console uses EventBridge (formerly known as CloudWatch Events) and SNS for email notifications.  To implement the same functionality, you need to set `enable_notification` in a `aws_amplify_branch` resource, as well as creating an EventBridge Rule, an SNS topic, and SNS subscriptions.\n\n```terraform\nresource \"aws_amplify_app\" \"example\" {\n  name = \"app\"\n}\n\nresource \"aws_amplify_branch\" \"master\" {\n  app_id      = aws_amplify_app.example.id\n  branch_name = \"master\"\n\n  # Enable SNS notifications.\n  enable_notification = true\n}\n\n# EventBridge Rule for Amplify notifications\n\nresource \"aws_cloudwatch_event_rule\" \"amplify_app_master\" {\n  name        = \"amplify-${aws_amplify_app.app.id}-${aws_amplify_branch.master.branch_name}-branch-notification\"\n  description = \"AWS Amplify build notifications for :  App: ${aws_amplify_app.app.id} Branch: ${aws_amplify_branch.master.branch_name}\"\n\n  event_pattern = jsonencode({\n    \"detail\" = {\n      \"appId\" = [\n        aws_amplify_app.example.id\n      ]\n      \"branchName\" = [\n        aws_amplify_branch.master.branch_name\n      ],\n      \"jobStatus\" = [\n        \"SUCCEED\",\n        \"FAILED\",\n        \"STARTED\"\n      ]\n    }\n    \"detail-type\" = [\n      \"Amplify Deployment Status Change\"\n    ]\n    \"source\" = [\n      \"aws.amplify\"\n    ]\n  })\n}\n\nresource \"aws_cloudwatch_event_target\" \"amplify_app_master\" {\n  rule      = aws_cloudwatch_event_rule.amplify_app_master.name\n  target_id = aws_amplify_branch.master.branch_name\n  arn       = aws_sns_topic.amplify_app_master.arn\n\n  input_transformer {\n    input_paths = {\n      jobId  = \"$.detail.jobId\"\n      appId  = \"$.detail.appId\"\n      region = \"$.region\"\n      branch = \"$.detail.branchName\"\n      status = \"$.detail.jobStatus\"\n    }\n\n    input_template = \"\\\"Build notification from the AWS Amplify Console for app: https://<branch>.<appId>.amplifyapp.com/. Your build status is <status>. Go to https://console.aws.amazon.com/amplify/home?region=<region>#<appId>/<branch>/<jobId> to view details on your build. \\\"\"\n  }\n}\n\n# SNS Topic for Amplify notifications\n\nresource \"aws_sns_topic\" \"amplify_app_master\" {\n  name = \"amplify-${aws_amplify_app.app.id}_${aws_amplify_branch.master.branch_name}\"\n}\n\ndata \"aws_iam_policy_document\" \"amplify_app_master\" {\n  statement {\n    sid = \"Allow_Publish_Events ${aws_amplify_branch.master.arn}\"\n\n    effect = \"Allow\"\n\n    actions = [\n      \"SNS:Publish\",\n    ]\n\n    principals {\n      type = \"Service\"\n      identifiers = [\n        \"events.amazonaws.com\",\n      ]\n    }\n\n    resources = [\n      aws_sns_topic.amplify_app_master.arn,\n    ]\n  }\n}\n\nresource \"aws_sns_topic_policy\" \"amplify_app_master\" {\n  arn    = aws_sns_topic.amplify_app_master.arn\n  policy = data.aws_iam_policy_document.amplify_app_master.json\n}\n\nresource \"aws_sns_topic_subscription\" \"this\" {\n  topic_arn = aws_sns_topic.amplify_app_master.arn\n  protocol  = \"email\"\n  endpoint  = \"user@acme.com\"\n}\n```\n\n## Argument Reference\n\nThis resource supports the following arguments:\n\n* `app_id` - (Required) Unique ID for an Amplify app.\n* `branch_name` - (Required) Name for the branch.\n* `backend_environment_arn` - (Optional) ARN for a backend environment that is part of an Amplify app.\n* `basic_auth_credentials` - (Optional) Basic authorization credentials for the branch.\n* `description` - (Optional) Description for the branch.\n* `display_name` - (Optional) Display name for a branch. This is used as the default domain prefix.\n* `enable_auto_build` - (Optional) Enables auto building for the branch.\n* `enable_basic_auth` - (Optional) Enables basic authorization for the branch.\n* `enable_notification` - (Optional) Enables notifications for the branch.\n* `enable_performance_mode` - (Optional) Enables performance mode for the branch.\n* `enable_pull_request_preview` - (Optional) Enables pull request previews for this branch.\n* `environment_variables` - (Optional) Environment variables for the branch.\n* `framework` - (Optional) Framework for the branch.\n* `pull_request_environment_name` - (Optional) Amplify environment name for the pull request.\n* `stage` - (Optional) Describes the current stage for the branch. Valid values: `PRODUCTION`, `BETA`, `DEVELOPMENT`, `EXPERIMENTAL`, `PULL_REQUEST`.\n* `tags` - (Optional) Key-value mapping of resource tags. If configured with a provider [`default_tags` configuration block](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#default_tags-configuration-block) present, tags with matching keys will overwrite those defined at the provider-level.\n* `ttl` - (Optional) Content Time To Live (TTL) for the website in seconds.\n\n## Attribute Reference\n\nThis resource exports the following attributes in addition to the arguments above:\n\n* `arn` - ARN for the branch.\n* `associated_resources` - A list of custom resources that are linked to this branch.\n* `custom_domains` - Custom domains for the branch.\n* `destination_branch` - Destination branch if the branch is a pull request branch.\n* `source_branch` - Source branch if the branch is a pull request branch.\n* `tags_all` - Map of tags assigned to the resource, including those inherited from the provider [`default_tags` configuration block](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#default_tags-configuration-block).\n\n## Import\n\nIn Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import Amplify branch using `app_id` and `branch_name`. For example:\n\n```terraform\nimport {\n  to = aws_amplify_branch.master\n  id = \"d2ypk4k47z8u6/master\"\n}\n```\n\nUsing `terraform import`, import Amplify branch using `app_id` and `branch_name`. For example:\n\n```console\n% terraform import aws_amplify_branch.master d2ypk4k47z8u6/master\n```\n",
      "language": "hcl",
      "path": "website/docs/r/amplify_branch.html.markdown",
      "slug": "amplify_branch",
      "subcategory": "Amplify",
      "title": "amplify_branch",
      "truncated": false
    },
    "links": {
      "self": "/v2/provider-docs/3197920"
    }
  }
}