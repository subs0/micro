{
  "data": {
    "type": "provider-docs",
    "id": "3198867",
    "attributes": {
      "category": "resources",
      "content": "---\nsubcategory: \"S3 (Simple Storage)\"\nlayout: \"aws\"\npage_title: \"AWS: aws_s3_bucket_lifecycle_configuration\"\ndescription: |-\n  Provides a S3 bucket lifecycle configuration resource.\n---\n\n# Resource: aws_s3_bucket_lifecycle_configuration\n\nProvides an independent configuration resource for S3 bucket [lifecycle configuration](https://docs.aws.amazon.com/AmazonS3/latest/userguide/object-lifecycle-mgmt.html).\n\nAn S3 Lifecycle configuration consists of one or more Lifecycle rules. Each rule consists of the following:\n\n* Rule metadata (`id` and `status`)\n* [Filter](#filter) identifying objects to which the rule applies\n* One or more transition or expiration actions\n\nFor more information see the Amazon S3 User Guide on [`Lifecycle Configuration Elements`](https://docs.aws.amazon.com/AmazonS3/latest/userguide/intro-lifecycle-rules.html).\n\n~> **NOTE:** S3 Buckets only support a single lifecycle configuration. Declaring multiple `aws_s3_bucket_lifecycle_configuration` resources to the same S3 Bucket will cause a perpetual difference in configuration.\n\n~> **NOTE:** Lifecycle configurations may take some time to fully propagate to all AWS S3 systems.\nRunning Terraform operations shortly after creating a lifecycle configuration may result in changes that affect configuration idempotence.\nSee the Amazon S3 User Guide on [setting lifecycle configuration on a bucket](https://docs.aws.amazon.com/AmazonS3/latest/userguide/how-to-set-lifecycle-configuration-intro.html).\n\n## Example Usage\n\n### With neither a filter nor prefix specified\n\nThe Lifecycle rule applies to a subset of objects based on the key name prefix (`\"\"`).\n\nThis configuration is intended to replicate the default behavior of the `lifecycle_rule`\nparameter in the Terraform AWS Provider `aws_s3_bucket` resource prior to `v4.0`.\n\n```terraform\nresource \"aws_s3_bucket_lifecycle_configuration\" \"example\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"rule-1\"\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n}\n```\n\n### Specifying an empty filter\n\nThe Lifecycle rule applies to all objects in the bucket.\n\n```terraform\nresource \"aws_s3_bucket_lifecycle_configuration\" \"example\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"rule-1\"\n\n    filter {}\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n}\n```\n\n### Specifying a filter using key prefixes\n\nThe Lifecycle rule applies to a subset of objects based on the key name prefix (`logs/`).\n\n```terraform\nresource \"aws_s3_bucket_lifecycle_configuration\" \"example\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"rule-1\"\n\n    filter {\n      prefix = \"logs/\"\n    }\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n}\n```\n\nIf you want to apply a Lifecycle action to a subset of objects based on different key name prefixes, specify separate rules.\n\n```terraform\nresource \"aws_s3_bucket_lifecycle_configuration\" \"example\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"rule-1\"\n\n    filter {\n      prefix = \"logs/\"\n    }\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n\n  rule {\n    id = \"rule-2\"\n\n    filter {\n      prefix = \"tmp/\"\n    }\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n}\n```\n\n### Specifying a filter based on an object tag\n\nThe Lifecycle rule specifies a filter based on a tag key and value. The rule then applies only to a subset of objects with the specific tag.\n\n```terraform\nresource \"aws_s3_bucket_lifecycle_configuration\" \"example\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"rule-1\"\n\n    filter {\n      tag {\n        key   = \"Name\"\n        value = \"Staging\"\n      }\n    }\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n}\n```\n\n### Specifying a filter based on multiple tags\n\nThe Lifecycle rule directs Amazon S3 to perform lifecycle actions on objects with two tags (with the specific tag keys and values). Notice `tags` is wrapped in the `and` configuration block.\n\n```terraform\nresource \"aws_s3_bucket_lifecycle_configuration\" \"example\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"rule-1\"\n\n    filter {\n      and {\n        tags = {\n          Key1 = \"Value1\"\n          Key2 = \"Value2\"\n        }\n      }\n    }\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n}\n```\n\n### Specifying a filter based on both prefix and one or more tags\n\nThe Lifecycle rule directs Amazon S3 to perform lifecycle actions on objects with the specified prefix and two tags (with the specific tag keys and values). Notice both `prefix` and `tags` are wrapped in the `and` configuration block.\n\n```terraform\nresource \"aws_s3_bucket_lifecycle_configuration\" \"example\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"rule-1\"\n\n    filter {\n      and {\n        prefix = \"logs/\"\n        tags = {\n          Key1 = \"Value1\"\n          Key2 = \"Value2\"\n        }\n      }\n    }\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n}\n```\n\n### Specifying a filter based on object size\n\nObject size values are in bytes. Maximum filter size is 5TB. Some storage classes have minimum object size limitations, for more information, see [Comparing the Amazon S3 storage classes](https://docs.aws.amazon.com/AmazonS3/latest/userguide/storage-class-intro.html#sc-compare).\n\n```terraform\nresource \"aws_s3_bucket_lifecycle_configuration\" \"example\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"rule-1\"\n\n    filter {\n      object_size_greater_than = 500\n    }\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n}\n```\n\n### Specifying a filter based on object size range and prefix\n\nThe `object_size_greater_than` must be less than the `object_size_less_than`. Notice both the object size range and prefix are wrapped in the `and` configuration block.\n\n```terraform\nresource \"aws_s3_bucket_lifecycle_configuration\" \"example\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"rule-1\"\n\n    filter {\n      and {\n        prefix                   = \"logs/\"\n        object_size_greater_than = 500\n        object_size_less_than    = 64000\n      }\n    }\n\n    # ... other transition/expiration actions ...\n\n    status = \"Enabled\"\n  }\n}\n```\n\n### Creating a Lifecycle Configuration for a bucket with versioning\n\n```terraform\nresource \"aws_s3_bucket\" \"bucket\" {\n  bucket = \"my-bucket\"\n}\n\nresource \"aws_s3_bucket_acl\" \"bucket_acl\" {\n  bucket = aws_s3_bucket.bucket.id\n  acl    = \"private\"\n}\n\nresource \"aws_s3_bucket_lifecycle_configuration\" \"bucket-config\" {\n  bucket = aws_s3_bucket.bucket.id\n\n  rule {\n    id = \"log\"\n\n    expiration {\n      days = 90\n    }\n\n    filter {\n      and {\n        prefix = \"log/\"\n\n        tags = {\n          rule      = \"log\"\n          autoclean = \"true\"\n        }\n      }\n    }\n\n    status = \"Enabled\"\n\n    transition {\n      days          = 30\n      storage_class = \"STANDARD_IA\"\n    }\n\n    transition {\n      days          = 60\n      storage_class = \"GLACIER\"\n    }\n  }\n\n  rule {\n    id = \"tmp\"\n\n    filter {\n      prefix = \"tmp/\"\n    }\n\n    expiration {\n      date = \"2023-01-13T00:00:00Z\"\n    }\n\n    status = \"Enabled\"\n  }\n}\n\nresource \"aws_s3_bucket\" \"versioning_bucket\" {\n  bucket = \"my-versioning-bucket\"\n}\n\nresource \"aws_s3_bucket_acl\" \"versioning_bucket_acl\" {\n  bucket = aws_s3_bucket.versioning_bucket.id\n  acl    = \"private\"\n}\n\nresource \"aws_s3_bucket_versioning\" \"versioning\" {\n  bucket = aws_s3_bucket.versioning_bucket.id\n  versioning_configuration {\n    status = \"Enabled\"\n  }\n}\n\nresource \"aws_s3_bucket_lifecycle_configuration\" \"versioning-bucket-config\" {\n  # Must have bucket versioning enabled first\n  depends_on = [aws_s3_bucket_versioning.versioning]\n\n  bucket = aws_s3_bucket.versioning_bucket.id\n\n  rule {\n    id = \"config\"\n\n    filter {\n      prefix = \"config/\"\n    }\n\n    noncurrent_version_expiration {\n      noncurrent_days = 90\n    }\n\n    noncurrent_version_transition {\n      noncurrent_days = 30\n      storage_class   = \"STANDARD_IA\"\n    }\n\n    noncurrent_version_transition {\n      noncurrent_days = 60\n      storage_class   = \"GLACIER\"\n    }\n\n    status = \"Enabled\"\n  }\n}\n```\n\n## Argument Reference\n\nThis resource supports the following arguments:\n\n* `bucket` - (Required) Name of the source S3 bucket you want Amazon S3 to monitor.\n* `expected_bucket_owner` - (Optional) Account ID of the expected bucket owner. If the bucket is owned by a different account, the request will fail with an HTTP 403 (Access Denied) error.\n* `rule` - (Required) List of configuration blocks describing the rules managing the replication. [See below](#rule).\n\n### rule\n\n~> **NOTE:** The `filter` argument, while Optional, is required if the `rule` configuration block does not contain a `prefix` **and** you intend to override the default behavior of setting the rule to filter objects with the empty string prefix (`\"\"`).\nSince `prefix` is deprecated by Amazon S3 and will be removed in the next major version of the Terraform AWS Provider, we recommend users either specify `filter` or leave both `filter` and `prefix` unspecified.\n\n~> **NOTE:** A rule cannot be updated from having a filter (via either the `rule.filter` parameter or when neither `rule.filter` and `rule.prefix` are specified) to only having a prefix via the `rule.prefix` parameter.\n\n~> **NOTE** Terraform cannot distinguish a difference between configurations that use `rule.filter {}` and configurations that neither use `rule.filter` nor `rule.prefix`, so a rule cannot be updated from applying to all objects in the bucket via `rule.filter {}` to applying to a subset of objects based on the key prefix `\"\"` and vice versa.\n\nThe `rule` configuration block supports the following arguments:\n\n* `abort_incomplete_multipart_upload` - (Optional) Configuration block that specifies the days since the initiation of an incomplete multipart upload that Amazon S3 will wait before permanently removing all parts of the upload. [See below](#abort_incomplete_multipart_upload).\n* `expiration` - (Optional) Configuration block that specifies the expiration for the lifecycle of the object in the form of date, days and, whether the object has a delete marker. [See below](#expiration).\n* `filter` - (Optional) Configuration block used to identify objects that a Lifecycle Rule applies to. [See below](#filter). If not specified, the `rule` will default to using `prefix`.\n* `id` - (Required) Unique identifier for the rule. The value cannot be longer than 255 characters.\n* `noncurrent_version_expiration` - (Optional) Configuration block that specifies when noncurrent object versions expire. [See below](#noncurrent_version_expiration).\n* `noncurrent_version_transition` - (Optional) Set of configuration blocks that specify the transition rule for the lifecycle rule that describes when noncurrent objects transition to a specific storage class. [See below](#noncurrent_version_transition).\n* `prefix` - (Optional) **DEPRECATED** Use `filter` instead. This has been deprecated by Amazon S3. Prefix identifying one or more objects to which the rule applies. Defaults to an empty string (`\"\"`) if `filter` is not specified.\n* `status` - (Required) Whether the rule is currently being applied. Valid values: `Enabled` or `Disabled`.\n* `transition` - (Optional) Set of configuration blocks that specify when an Amazon S3 object transitions to a specified storage class. [See below](#transition).\n\n### abort_incomplete_multipart_upload\n\nThe `abort_incomplete_multipart_upload` configuration block supports the following arguments:\n\n* `days_after_initiation` - Number of days after which Amazon S3 aborts an incomplete multipart upload.\n\n### expiration\n\nThe `expiration` configuration block supports the following arguments:\n\n* `date` - (Optional) Date the object is to be moved or deleted. The date value must be in [RFC3339 full-date format](https://datatracker.ietf.org/doc/html/rfc3339#section-5.6) e.g. `2023-08-22`.\n* `days` - (Optional) Lifetime, in days, of the objects that are subject to the rule. The value must be a non-zero positive integer.\n* `expired_object_delete_marker` - (Optional, Conflicts with `date` and `days`) Indicates whether Amazon S3 will remove a delete marker with no noncurrent versions. If set to `true`, the delete marker will be expired; if set to `false` the policy takes no action.\n\n### filter\n\n~> **NOTE:** The `filter` configuration block must either be specified as the empty configuration block (`filter {}`) or with exactly one of `prefix`, `tag`, `and`, `object_size_greater_than` or `object_size_less_than` specified.\n\nThe `filter` configuration block supports the following arguments:\n\n* `and`- (Optional) Configuration block used to apply a logical `AND` to two or more predicates. [See below](#and). The Lifecycle Rule will apply to any object matching all the predicates configured inside the `and` block.\n* `object_size_greater_than` - (Optional) Minimum object size (in bytes) to which the rule applies.\n* `object_size_less_than` - (Optional) Maximum object size (in bytes) to which the rule applies.\n* `prefix` - (Optional) Prefix identifying one or more objects to which the rule applies. Defaults to an empty string (`\"\"`) if not specified.\n* `tag` - (Optional) Configuration block for specifying a tag key and value. [See below](#tag).\n\n### noncurrent_version_expiration\n\nThe `noncurrent_version_expiration` configuration block supports the following arguments:\n\n* `newer_noncurrent_versions` - (Optional) Number of noncurrent versions Amazon S3 will retain. Must be a non-zero positive integer.\n* `noncurrent_days` - (Optional) Number of days an object is noncurrent before Amazon S3 can perform the associated action. Must be a positive integer.\n\n### noncurrent_version_transition\n\nThe `noncurrent_version_transition` configuration block supports the following arguments:\n\n* `newer_noncurrent_versions` - (Optional) Number of noncurrent versions Amazon S3 will retain. Must be a non-zero positive integer.\n* `noncurrent_days` - (Optional) Number of days an object is noncurrent before Amazon S3 can perform the associated action.\n* `storage_class` - (Required) Class of storage used to store the object. Valid Values: `GLACIER`, `STANDARD_IA`, `ONEZONE_IA`, `INTELLIGENT_TIERING`, `DEEP_ARCHIVE`, `GLACIER_IR`.\n\n### transition\n\nThe `transition` configuration block supports the following arguments:\n\n~> **Note:** Only one of `date` or `days` should be specified. If neither are specified, the `transition` will default to 0 `days`.\n\n* `date` - (Optional, Conflicts with `days`) Date objects are transitioned to the specified storage class. The date value must be in [RFC3339 full-date format](https://datatracker.ietf.org/doc/html/rfc3339#section-5.6) e.g. `2023-08-22`.\n* `days` - (Optional, Conflicts with `date`) Number of days after creation when objects are transitioned to the specified storage class. The value must be a positive integer. If both `days` and `date` are not specified, defaults to `0`. Valid values depend on `storage_class`, see [Transition objects using Amazon S3 Lifecycle](https://docs.aws.amazon.com/AmazonS3/latest/userguide/lifecycle-transition-general-considerations.html) for more details.\n* `storage_class` - Class of storage used to store the object. Valid Values: `GLACIER`, `STANDARD_IA`, `ONEZONE_IA`, `INTELLIGENT_TIERING`, `DEEP_ARCHIVE`, `GLACIER_IR`.\n\n### and\n\nThe `and` configuration block supports the following arguments:\n\n* `object_size_greater_than` - (Optional) Minimum object size to which the rule applies. Value must be at least `0` if specified.\n* `object_size_less_than` - (Optional) Maximum object size to which the rule applies. Value must be at least `1` if specified.\n* `prefix` - (Optional) Prefix identifying one or more objects to which the rule applies.\n* `tags` - (Optional) Key-value map of resource tags. All of these tags must exist in the object's tag set in order for the rule to apply.\n\n### tag\n\nThe `tag` configuration block supports the following arguments:\n\n* `key` - (Required) Name of the object key.\n* `value` - (Required) Value of the tag.\n\n## Attribute Reference\n\nThis resource exports the following attributes in addition to the arguments above:\n\n* `id` - The `bucket` or `bucket` and `expected_bucket_owner` separated by a comma (`,`) if the latter is provided.\n\n## Import\n\nIn Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import S3 bucket lifecycle configuration using the `bucket` or using the `bucket` and `expected_bucket_owner` separated by a comma (`,`). For example:\n\nIf the owner (account ID) of the source bucket is the same account used to configure the Terraform AWS Provider, import using the `bucket`:\n\n```terraform\nimport {\n  to = aws_s3_bucket_lifecycle_configuration.example\n  id = \"bucket-name\"\n}\n```\n\nIf the owner (account ID) of the source bucket differs from the account used to configure the Terraform AWS Provider, import using the `bucket` and `expected_bucket_owner` separated by a comma (`,`):\n\n```terraform\nimport {\n  to = aws_s3_bucket_lifecycle_configuration.example\n  id = \"bucket-name,123456789012\"\n}\n```\n\n**Using `terraform import` to import** S3 bucket lifecycle configuration using the `bucket` or using the `bucket` and `expected_bucket_owner` separated by a comma (`,`). For example:\n\nIf the owner (account ID) of the source bucket is the same account used to configure the Terraform AWS Provider, import using the `bucket`:\n\n```console\n% terraform import aws_s3_bucket_lifecycle_configuration.example bucket-name\n```\n\nIf the owner (account ID) of the source bucket differs from the account used to configure the Terraform AWS Provider, import using the `bucket` and `expected_bucket_owner` separated by a comma (`,`):\n\n```console\n% terraform import aws_s3_bucket_lifecycle_configuration.example bucket-name,123456789012\n```\n",
      "language": "hcl",
      "path": "website/docs/r/s3_bucket_lifecycle_configuration.html.markdown",
      "slug": "s3_bucket_lifecycle_configuration",
      "subcategory": "S3 (Simple Storage)",
      "title": "s3_bucket_lifecycle_configuration",
      "truncated": false
    },
    "links": {
      "self": "/v2/provider-docs/3198867"
    }
  }
}