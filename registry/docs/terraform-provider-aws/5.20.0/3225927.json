{
  "data": {
    "type": "provider-docs",
    "id": "3225927",
    "attributes": {
      "category": "resources",
      "content": "---\nsubcategory: \"EC2 (Elastic Compute Cloud)\"\nlayout: \"aws\"\npage_title: \"AWS: aws_spot_fleet_request\"\ndescription: |-\n  Provides a Spot Fleet Request resource.\n---\n\n# Resource: aws_spot_fleet_request\n\nProvides an EC2 Spot Fleet Request resource. This allows a fleet of Spot\ninstances to be requested on the Spot market.\n\n~> **NOTE [AWS strongly discourages](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/spot-best-practices.html#which-spot-request-method-to-use) the use of the legacy APIs called by this resource.\nWe recommend using the [EC2 Fleet](ec2_fleet.html) or [Auto Scaling Group](autoscaling_group.html) resources instead.\n\n## Example Usage\n\n### Using launch specifications\n\n```terraform\n# Request a Spot fleet\nresource \"aws_spot_fleet_request\" \"cheap_compute\" {\n  iam_fleet_role      = \"arn:aws:iam::12345678:role/spot-fleet\"\n  spot_price          = \"0.03\"\n  allocation_strategy = \"diversified\"\n  target_capacity     = 6\n  valid_until         = \"2019-11-04T20:44:20Z\"\n\n  launch_specification {\n    instance_type            = \"m4.10xlarge\"\n    ami                      = \"ami-1234\"\n    spot_price               = \"2.793\"\n    placement_tenancy        = \"dedicated\"\n    iam_instance_profile_arn = aws_iam_instance_profile.example.arn\n  }\n\n  launch_specification {\n    instance_type            = \"m4.4xlarge\"\n    ami                      = \"ami-5678\"\n    key_name                 = \"my-key\"\n    spot_price               = \"1.117\"\n    iam_instance_profile_arn = aws_iam_instance_profile.example.arn\n    availability_zone        = \"us-west-1a\"\n    subnet_id                = \"subnet-1234\"\n    weighted_capacity        = 35\n\n    root_block_device {\n      volume_size = \"300\"\n      volume_type = \"gp2\"\n    }\n\n    tags = {\n      Name = \"spot-fleet-example\"\n    }\n  }\n}\n```\n\n### Using launch templates\n\n```terraform\nresource \"aws_launch_template\" \"foo\" {\n  name          = \"launch-template\"\n  image_id      = \"ami-516b9131\"\n  instance_type = \"m1.small\"\n  key_name      = \"some-key\"\n}\n\nresource \"aws_spot_fleet_request\" \"foo\" {\n  iam_fleet_role  = \"arn:aws:iam::12345678:role/spot-fleet\"\n  spot_price      = \"0.005\"\n  target_capacity = 2\n  valid_until     = \"2019-11-04T20:44:20Z\"\n\n  launch_template_config {\n    launch_template_specification {\n      id      = aws_launch_template.foo.id\n      version = aws_launch_template.foo.latest_version\n    }\n  }\n\n  depends_on = [aws_iam_policy_attachment.test-attach]\n}\n```\n\n~> **NOTE:** Terraform does not support the functionality where multiple `subnet_id` or `availability_zone` parameters can be specified in the same\nlaunch configuration block. If you want to specify multiple values, then separate launch configuration blocks should be used or launch template overrides should be configured, one per subnet:\n\n### Using multiple launch specifications\n\n```terraform\nresource \"aws_spot_fleet_request\" \"foo\" {\n  iam_fleet_role  = \"arn:aws:iam::12345678:role/spot-fleet\"\n  spot_price      = \"0.005\"\n  target_capacity = 2\n  valid_until     = \"2019-11-04T20:44:20Z\"\n\n  launch_specification {\n    instance_type     = \"m1.small\"\n    ami               = \"ami-d06a90b0\"\n    key_name          = \"my-key\"\n    availability_zone = \"us-west-2a\"\n  }\n\n  launch_specification {\n    instance_type     = \"m5.large\"\n    ami               = \"ami-d06a90b0\"\n    key_name          = \"my-key\"\n    availability_zone = \"us-west-2a\"\n  }\n}\n```\n\n-> In this example, we use a [`dynamic` block](https://www.terraform.io/language/expressions/dynamic-blocks) to define zero or more `launch_specification` blocks, producing one for each element in the list of subnet ids.\n\n```terraform\nvariable \"subnets\" {}\n\nresource \"aws_spot_fleet_request\" \"example\" {\n  iam_fleet_role                      = \"arn:aws:iam::12345678:role/spot-fleet\"\n  target_capacity                     = 3\n  valid_until                         = \"2019-11-04T20:44:20Z\"\n  allocation_strategy                 = \"lowestPrice\"\n  fleet_type                          = \"request\"\n  wait_for_fulfillment                = \"true\"\n  terminate_instances_with_expiration = \"true\"\n\n\n  dynamic \"launch_specification\" {\n    for_each = [for s in var.subnets : {\n      subnet_id = s[1]\n    }]\n    content {\n      ami                    = \"ami-1234\"\n      instance_type          = \"m4.4xlarge\"\n      subnet_id              = launch_specification.value.subnet_id\n      vpc_security_group_ids = \"sg-123456\"\n\n      root_block_device {\n        volume_size           = \"8\"\n        volume_type           = \"gp2\"\n        delete_on_termination = \"true\"\n      }\n\n      tags = {\n        Name        = \"Spot Node\"\n        tag_builder = \"builder\"\n      }\n    }\n  }\n}\n```\n\n### Using multiple launch configurations\n\n```terraform\ndata \"aws_subnets\" \"example\" {\n  filter {\n    name   = \"vpc-id\"\n    values = [var.vpc_id]\n  }\n}\n\nresource \"aws_launch_template\" \"foo\" {\n  name          = \"launch-template\"\n  image_id      = \"ami-516b9131\"\n  instance_type = \"m1.small\"\n  key_name      = \"some-key\"\n}\n\nresource \"aws_spot_fleet_request\" \"foo\" {\n  iam_fleet_role  = \"arn:aws:iam::12345678:role/spot-fleet\"\n  spot_price      = \"0.005\"\n  target_capacity = 2\n  valid_until     = \"2019-11-04T20:44:20Z\"\n\n  launch_template_config {\n    launch_template_specification {\n      id      = aws_launch_template.foo.id\n      version = aws_launch_template.foo.latest_version\n    }\n    overrides {\n      subnet_id = data.aws_subnets.example.ids[0]\n    }\n    overrides {\n      subnet_id = data.aws_subnets.example.ids[1]\n    }\n    overrides {\n      subnet_id = data.aws_subnets.example.ids[2]\n    }\n  }\n\n  depends_on = [aws_iam_policy_attachment.test-attach]\n}\n```\n\n## Argument Reference\n\nMost of these arguments directly correspond to the\n[official API](http://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_SpotFleetRequestConfigData.html).\n\n* `iam_fleet_role` - (Required) Grants the Spot fleet permission to terminate\n  Spot instances on your behalf when you cancel its Spot fleet request using\nCancelSpotFleetRequests or when the Spot fleet request expires, if you set\nterminateInstancesWithExpiration.\n* `context` - (Optional) Reserved.\n* `replace_unhealthy_instances` - (Optional) Indicates whether Spot fleet should replace unhealthy instances. Default `false`.\n* `launch_specification` - (Optional) Used to define the launch configuration of the\n  spot-fleet request. Can be specified multiple times to define different bids\nacross different markets and instance types. Conflicts with `launch_template_config`. At least one of `launch_specification` or `launch_template_config` is required.\n\n    **Note**: This takes in similar but not\n    identical inputs as [`aws_instance`](instance.html).  There are limitations on\n    what you can specify. See the list of officially supported inputs in the\n    [reference documentation](http://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_SpotFleetLaunchSpecification.html). Any normal [`aws_instance`](instance.html) parameter that corresponds to those inputs may be used and it have\n    a additional parameter `iam_instance_profile_arn` takes `aws_iam_instance_profile` attribute `arn` as input.\n\n* `launch_template_config` - (Optional) Launch template configuration block. See [Launch Template Configs](#launch-template-configs) below for more details. Conflicts with `launch_specification`. At least one of `launch_specification` or `launch_template_config` is required.\n* `spot_maintenance_strategies` - (Optional) Nested argument containing maintenance strategies for managing your Spot Instances that are at an elevated risk of being interrupted. Defined below.\n* `spot_price` - (Optional; Default: On-demand price) The maximum bid price per unit hour.\n* `wait_for_fulfillment` - (Optional; Default: false) If set, Terraform will\n  wait for the Spot Request to be fulfilled, and will throw an error if the\n  timeout of 10m is reached.\n* `target_capacity` - The number of units to request. You can choose to set the\n  target capacity in terms of instances or a performance characteristic that is\n  important to your application workload, such as vCPUs, memory, or I/O.\n* `target_capacity_unit_type` - (Optional) The unit for the target capacity. This can only be done with `instance_requirements` defined\n* `allocation_strategy` - Indicates how to allocate the target capacity across\n  the Spot pools specified by the Spot fleet request. Valid values: `lowestPrice`, `diversified`, `capacityOptimized`, `capacityOptimizedPrioritized`, and `priceCapacityOptimized`. The default is\n  `lowestPrice`.\n* `instance_pools_to_use_count` - (Optional; Default: 1)\n  The number of Spot pools across which to allocate your target Spot capacity.\n  Valid only when `allocation_strategy` is set to `lowestPrice`. Spot Fleet selects\n  the cheapest Spot pools and evenly allocates your target Spot capacity across\n  the number of Spot pools that you specify.\n* `excess_capacity_termination_policy` - Indicates whether running Spot\n  instances should be terminated if the target capacity of the Spot fleet\n  request is decreased below the current size of the Spot fleet.\n* `terminate_instances_with_expiration` - (Optional) Indicates whether running Spot\n  instances should be terminated when the Spot fleet request expires.\n* `terminate_instances_on_delete` - (Optional) Indicates whether running Spot\n  instances should be terminated when the resource is deleted (and the Spot fleet request cancelled).\n  If no value is specified, the value of the `terminate_instances_with_expiration` argument is used.\n* `instance_interruption_behaviour` - (Optional) Indicates whether a Spot\n  instance stops or terminates when it is interrupted. Default is\n  `terminate`.\n* `fleet_type` - (Optional) The type of fleet request. Indicates whether the Spot Fleet only requests the target\n  capacity or also attempts to maintain it. Default is `maintain`.\n* `valid_until` - (Optional) The end date and time of the request, in UTC [RFC3339](https://tools.ietf.org/html/rfc3339#section-5.8) format(for example, YYYY-MM-DDTHH:MM:SSZ). At this point, no new Spot instance requests are placed or enabled to fulfill the request.\n* `valid_from` - (Optional) The start date and time of the request, in UTC [RFC3339](https://tools.ietf.org/html/rfc3339#section-5.8) format(for example, YYYY-MM-DDTHH:MM:SSZ). The default is to start fulfilling the request immediately.\n* `load_balancers` (Optional) A list of elastic load balancer names to add to the Spot fleet.\n* `target_group_arns` (Optional) A list of `aws_alb_target_group` ARNs, for use with Application Load Balancing.\n* `on_demand_allocation_strategy` - The order of the launch template overrides to use in fulfilling On-Demand capacity. the possible values are: `lowestPrice` and `prioritized`. the default is `lowestPrice`.\n* `on_demand_max_total_price` - The maximum amount per hour for On-Demand Instances that you're willing to pay. When the maximum amount you're willing to pay is reached, the fleet stops launching instances even if it hasn’t met the target capacity.\n* `on_demand_target_capacity` - The number of On-Demand units to request. If the request type is `maintain`, you can specify a target capacity of 0 and add capacity later.\n* `tags` - (Optional) A map of tags to assign to the resource. If configured with a provider [`default_tags` configuration block](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#default_tags-configuration-block) present, tags with matching keys will overwrite those defined at the provider-level.\n\n### Launch Template Configs\n\nThe `launch_template_config` block supports the following:\n\n* `launch_template_specification` - (Required) Launch template specification. See [Launch Template Specification](#launch-template-specification) below for more details.\n* `overrides` - (Optional) One or more override configurations. See [Overrides](#overrides) below for more details.\n\n### Launch Template Specification\n\n* `id` - The ID of the launch template. Conflicts with `name`.\n* `name` - The name of the launch template. Conflicts with `id`.\n* `version` - (Optional) Template version. Unlike the autoscaling equivalent, does not support `$Latest` or `$Default`, so use the launch_template resource's attribute, e.g., `\"${aws_launch_template.foo.latest_version}\"`. It will use the default version if omitted.\n\n    **Note:** The specified launch template can specify only a subset of the\n    inputs of [`aws_launch_template`](launch_template.html).  There are limitations on\n    what you can specify as spot fleet does not support all the attributes that are supported by autoscaling groups. [AWS documentation](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-launch-templates.html#launch-templates-spot-fleet) is currently sparse, but at least `instance_initiated_shutdown_behavior` is confirmed unsupported.\n\n### spot_maintenance_strategies\n\n* `capacity_rebalance` - (Optional) Nested argument containing the capacity rebalance for your fleet request. Defined below.\n\n### capacity_rebalance\n\n* `replacement_strategy` - (Optional) The replacement strategy to use. Only available for spot fleets with `fleet_type` set to `maintain`. Valid values: `launch`.\n\n### Overrides\n\n* `availability_zone` - (Optional) The availability zone in which to place the request.\n* `instance_requirements` - (Optional) The instance requirements. See below.\n* `instance_type` - (Optional) The type of instance to request.\n* `priority` - (Optional) The priority for the launch template override. The lower the number, the higher the priority. If no number is set, the launch template override has the lowest priority.\n* `spot_price` - (Optional) The maximum spot bid for this override request.\n* `subnet_id` - (Optional) The subnet in which to launch the requested instance.\n* `weighted_capacity` - (Optional) The capacity added to the fleet by a fulfilled request.\n\n### Instance Requirements\n\nThis configuration block supports the following:\n\n* `accelerator_count` - (Optional) Block describing the minimum and maximum number of accelerators (GPUs, FPGAs, or AWS Inferentia chips). Default is no minimum or maximum.\n    * `min` - (Optional) Minimum.\n    * `max` - (Optional) Maximum. Set to `0` to exclude instance types with accelerators.\n* `accelerator_manufacturers` - (Optional) List of accelerator manufacturer names. Default is any manufacturer.\n\n    ```\n    Valid names:\n      * amazon-web-services\n      * amd\n      * nvidia\n      * xilinx\n    ```\n\n* `accelerator_names` - (Optional) List of accelerator names. Default is any acclerator.\n\n    ```\n    Valid names:\n      * a100            - NVIDIA A100 GPUs\n      * v100            - NVIDIA V100 GPUs\n      * k80             - NVIDIA K80 GPUs\n      * t4              - NVIDIA T4 GPUs\n      * m60             - NVIDIA M60 GPUs\n      * radeon-pro-v520 - AMD Radeon Pro V520 GPUs\n      * vu9p            - Xilinx VU9P FPGAs\n    ```\n\n* `accelerator_total_memory_mib` - (Optional) Block describing the minimum and maximum total memory of the accelerators. Default is no minimum or maximum.\n    * `min` - (Optional) Minimum.\n    * `max` - (Optional) Maximum.\n* `accelerator_types` - (Optional) List of accelerator types. Default is any accelerator type.\n\n    ```\n    Valid types:\n      * fpga\n      * gpu\n      * inference\n    ```\n\n* `allowed_instance_types` - (Optional) List of instance types to apply your specified attributes against. All other instance types are ignored, even if they match your specified attributes. You can use strings with one or more wild cards, represented by an asterisk (\\*), to allow an instance type, size, or generation. The following are examples: `m5.8xlarge`, `c5*.*`, `m5a.*`, `r*`, `*3*`. For example, if you specify `c5*`, you are allowing the entire C5 instance family, which includes all C5a and C5n instance types. If you specify `m5a.*`, you are allowing all the M5a instance types, but not the M5n instance types. Maximum of 400 entries in the list; each entry is limited to 30 characters. Default is all instance types.\n\n    ~> **NOTE:** If you specify `allowed_instance_types`, you can't specify `excluded_instance_types`.\n\n* `bare_metal` - (Optional) Indicate whether bare metal instace types should be `included`, `excluded`, or `required`. Default is `excluded`.\n* `baseline_ebs_bandwidth_mbps` - (Optional) Block describing the minimum and maximum baseline EBS bandwidth, in Mbps. Default is no minimum or maximum.\n    * `min` - (Optional) Minimum.\n    * `max` - (Optional) Maximum.\n* `burstable_performance` - (Optional) Indicate whether burstable performance instance types should be `included`, `excluded`, or `required`. Default is `excluded`.\n* `cpu_manufacturers` (Optional) List of CPU manufacturer names. Default is any manufacturer.\n\n    ~> **NOTE:** Don't confuse the CPU hardware manufacturer with the CPU hardware architecture. Instances will be launched with a compatible CPU architecture based on the Amazon Machine Image (AMI) that you specify in your launch template.\n\n    ```\n    Valid names:\n      * amazon-web-services\n      * amd\n      * intel\n    ```\n\n* `excluded_instance_types` - (Optional) List of instance types to exclude. You can use strings with one or more wild cards, represented by an asterisk (\\*), to exclude an instance type, size, or generation. The following are examples: `m5.8xlarge`, `c5*.*`, `m5a.*`, `r*`, `*3*`. For example, if you specify `c5*`, you are excluding the entire C5 instance family, which includes all C5a and C5n instance types. If you specify `m5a.*`, you are excluding all the M5a instance types, but not the M5n instance types. Maximum of 400 entries in the list; each entry is limited to 30 characters. Default is no excluded instance types.\n\n    ~> **NOTE:** If you specify `excluded_instance_types`, you can't specify `allowed_instance_types`.\n\n* `instance_generations` - (Optional) List of instance generation names. Default is any generation.\n\n    ```\n    Valid names:\n      * current  - Recommended for best performance.\n      * previous - For existing applications optimized for older instance types.\n    ```\n\n* `local_storage` - (Optional) Indicate whether instance types with local storage volumes are `included`, `excluded`, or `required`. Default is `included`.\n* `local_storage_types` - (Optional) List of local storage type names. Default any storage type.\n\n    ```\n    Value names:\n      * hdd - hard disk drive\n      * ssd - solid state drive\n    ```\n\n* `memory_gib_per_vcpu` - (Optional) Block describing the minimum and maximum amount of memory (GiB) per vCPU. Default is no minimum or maximum.\n    * `min` - (Optional) Minimum. May be a decimal number, e.g. `0.5`.\n    * `max` - (Optional) Maximum. May be a decimal number, e.g. `0.5`.\n* `memory_mib` - (Optional) Block describing the minimum and maximum amount of memory (MiB). Default is no maximum.\n    * `min` - (Optional) Minimum.\n    * `max` - (Optional) Maximum.\n* `network_bandwidth_gbps` - (Optional) Block describing the minimum and maximum amount of network bandwidth, in gigabits per second (Gbps). Default is no minimum or maximum.\n    * `min` - (Optional) Minimum.\n    * `max` - (Optional) Maximum.\n* `network_interface_count` - (Optional) Block describing the minimum and maximum number of network interfaces. Default is no minimum or maximum.\n    * `min` - (Optional) Minimum.\n    * `max` - (Optional) Maximum.\n* `on_demand_max_price_percentage_over_lowest_price` - (Optional) The price protection threshold for On-Demand Instances. This is the maximum you’ll pay for an On-Demand Instance, expressed as a percentage higher than the cheapest M, C, or R instance type with your specified attributes. When Amazon EC2 Auto Scaling selects instance types with your attributes, we will exclude instance types whose price is higher than your threshold. The parameter accepts an integer, which Amazon EC2 Auto Scaling interprets as a percentage. To turn off price protection, specify a high value, such as 999999. Default is 20.\n\n    If you set DesiredCapacityType to vcpu or memory-mib, the price protection threshold is applied based on the per vCPU or per memory price instead of the per instance price.\n* `require_hibernate_support` - (Optional) Indicate whether instance types must support On-Demand Instance Hibernation, either `true` or `false`. Default is `false`.\n* `spot_max_price_percentage_over_lowest_price` - (Optional) The price protection threshold for Spot Instances. This is the maximum you’ll pay for a Spot Instance, expressed as a percentage higher than the cheapest M, C, or R instance type with your specified attributes. When Amazon EC2 Auto Scaling selects instance types with your attributes, we will exclude instance types whose price is higher than your threshold. The parameter accepts an integer, which Amazon EC2 Auto Scaling interprets as a percentage. To turn off price protection, specify a high value, such as 999999. Default is 100.\n\n    If you set DesiredCapacityType to vcpu or memory-mib, the price protection threshold is applied based on the per vCPU or per memory price instead of the per instance price.\n* `total_local_storage_gb` - (Optional) Block describing the minimum and maximum total local storage (GB). Default is no minimum or maximum.\n    * `min` - (Optional) Minimum. May be a decimal number, e.g. `0.5`.\n    * `max` - (Optional) Maximum. May be a decimal number, e.g. `0.5`.\n* `vcpu_count` - (Optional) Block describing the minimum and maximum number of vCPUs. Default is no maximum.\n    * `min` - (Optional) Minimum.\n    * `max` - (Optional) Maximum.\n\n## Attribute Reference\n\nThis resource exports the following attributes in addition to the arguments above:\n\n* `id` - The Spot fleet request ID\n* `spot_request_state` - The state of the Spot fleet request.\n* `tags_all` - A map of tags assigned to the resource, including those inherited from the provider [`default_tags` configuration block](https://registry.terraform.io/providers/hashicorp/aws/latest/docs#default_tags-configuration-block).\n\n## Timeouts\n\n[Configuration options](https://developer.hashicorp.com/terraform/language/resources/syntax#operation-timeouts):\n\n* `create` - (Default `10m`)\n* `delete` - (Default `15m`)\n\n## Import\n\nIn Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import Spot Fleet Requests using `id`. For example:\n\n```terraform\nimport {\n  to = aws_spot_fleet_request.fleet\n  id = \"sfr-005e9ec8-5546-4c31-b317-31a62325411e\"\n}\n```\n\nUsing `terraform import`, import Spot Fleet Requests using `id`. For example:\n\n```console\n% terraform import aws_spot_fleet_request.fleet sfr-005e9ec8-5546-4c31-b317-31a62325411e\n```\n",
      "language": "hcl",
      "path": "website/docs/r/spot_fleet_request.html.markdown",
      "slug": "spot_fleet_request",
      "subcategory": "EC2 (Elastic Compute Cloud)",
      "title": "spot_fleet_request",
      "truncated": false
    },
    "links": {
      "self": "/v2/provider-docs/3225927"
    }
  }
}