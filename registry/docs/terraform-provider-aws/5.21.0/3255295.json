{
  "data": {
    "type": "provider-docs",
    "id": "3255295",
    "attributes": {
      "category": "resources",
      "content": "---\nsubcategory: \"GuardDuty\"\nlayout: aws\npage_title: 'AWS: aws_guardduty_publishing_destination'\ndescription: Provides a resource to manage a GuardDuty PublishingDestination\n---\n\n# Resource: aws_guardduty_publishing_destination\n\nProvides a resource to manage a GuardDuty PublishingDestination. Requires an existing GuardDuty Detector.\n\n## Example Usage\n\n```terraform\ndata \"aws_caller_identity\" \"current\" {}\n\ndata \"aws_region\" \"current\" {}\n\ndata \"aws_iam_policy_document\" \"bucket_pol\" {\n  statement {\n    sid = \"Allow PutObject\"\n    actions = [\n      \"s3:PutObject\"\n    ]\n\n    resources = [\n      \"${aws_s3_bucket.gd_bucket.arn}/*\"\n    ]\n\n    principals {\n      type        = \"Service\"\n      identifiers = [\"guardduty.amazonaws.com\"]\n    }\n  }\n\n  statement {\n    sid = \"Allow GetBucketLocation\"\n    actions = [\n      \"s3:GetBucketLocation\"\n    ]\n\n    resources = [\n      aws_s3_bucket.gd_bucket.arn\n    ]\n\n    principals {\n      type        = \"Service\"\n      identifiers = [\"guardduty.amazonaws.com\"]\n    }\n  }\n}\n\ndata \"aws_iam_policy_document\" \"kms_pol\" {\n\n  statement {\n    sid = \"Allow GuardDuty to encrypt findings\"\n    actions = [\n      \"kms:GenerateDataKey\"\n    ]\n\n    resources = [\n      \"arn:aws:kms:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:key/*\"\n    ]\n\n    principals {\n      type        = \"Service\"\n      identifiers = [\"guardduty.amazonaws.com\"]\n    }\n  }\n\n  statement {\n    sid = \"Allow all users to modify/delete key (test only)\"\n    actions = [\n      \"kms:*\"\n    ]\n\n    resources = [\n      \"arn:aws:kms:${data.aws_region.current.name}:${data.aws_caller_identity.current.account_id}:key/*\"\n    ]\n\n    principals {\n      type        = \"AWS\"\n      identifiers = [\"arn:aws:iam::${data.aws_caller_identity.current.account_id}:root\"]\n    }\n  }\n\n}\n\nresource \"aws_guardduty_detector\" \"test_gd\" {\n  enable = true\n}\n\nresource \"aws_s3_bucket\" \"gd_bucket\" {\n  bucket        = \"example\"\n  force_destroy = true\n}\n\nresource \"aws_s3_bucket_acl\" \"gd_bucket_acl\" {\n  bucket = aws_s3_bucket.gd_bucket.id\n  acl    = \"private\"\n}\n\nresource \"aws_s3_bucket_policy\" \"gd_bucket_policy\" {\n  bucket = aws_s3_bucket.gd_bucket.id\n  policy = data.aws_iam_policy_document.bucket_pol.json\n}\n\nresource \"aws_kms_key\" \"gd_key\" {\n  description             = \"Temporary key for AccTest of TF\"\n  deletion_window_in_days = 7\n  policy                  = data.aws_iam_policy_document.kms_pol.json\n}\n\nresource \"aws_guardduty_publishing_destination\" \"test\" {\n  detector_id     = aws_guardduty_detector.test_gd.id\n  destination_arn = aws_s3_bucket.gd_bucket.arn\n  kms_key_arn     = aws_kms_key.gd_key.arn\n\n  depends_on = [\n    aws_s3_bucket_policy.gd_bucket_policy,\n  ]\n}\n```\n\n~> **Note:** Please do not use this simple example for Bucket-Policy and KMS Key Policy in a production environment. It is much too open for such a use-case. Refer to the AWS documentation here: https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_exportfindings.html\n\n## Argument Reference\n\nThis resource supports the following arguments:\n\n* `detector_id` - (Required) The detector ID of the GuardDuty.\n* `destination_arn` - (Required) The bucket arn and prefix under which the findings get exported. Bucket-ARN is required, the prefix is optional and will be `AWSLogs/[Account-ID]/GuardDuty/[Region]/` if not provided\n* `kms_key_arn` - (Required) The ARN of the KMS key used to encrypt GuardDuty findings. GuardDuty enforces this to be encrypted.\n* `destination_type`- (Optional) Currently there is only \"S3\" available as destination type which is also the default value\n\n~> **Note:** In case of missing permissions (S3 Bucket Policy _or_ KMS Key permissions) the resource will fail to create. If the permissions are changed after resource creation, this can be asked from the AWS API via the \"DescribePublishingDestination\" call (https://docs.aws.amazon.com/cli/latest/reference/guardduty/describe-publishing-destination.html).\n\n## Attribute Reference\n\nThis resource exports the following attributes in addition to the arguments above:\n\n* `id` - The ID of the GuardDuty PublishingDestination and the detector ID. Format: `<DetectorID>:<PublishingDestinationID>`\n\n## Import\n\nIn Terraform v1.5.0 and later, use an [`import` block](https://developer.hashicorp.com/terraform/language/import) to import GuardDuty PublishingDestination using the master GuardDuty detector ID and PublishingDestinationID. For example:\n\n```terraform\nimport {\n  to = aws_guardduty_publishing_destination.test\n  id = \"a4b86f26fa42e7e7cf0d1c333ea77777:a4b86f27a0e464e4a7e0516d242f1234\"\n}\n```\n\nUsing `terraform import`, import GuardDuty PublishingDestination using the master GuardDuty detector ID and PublishingDestinationID. For example:\n\n```console\n% terraform import aws_guardduty_publishing_destination.test a4b86f26fa42e7e7cf0d1c333ea77777:a4b86f27a0e464e4a7e0516d242f1234\n```\n",
      "language": "hcl",
      "path": "website/docs/r/guardduty_publishing_destination.html.markdown",
      "slug": "guardduty_publishing_destination",
      "subcategory": "GuardDuty",
      "title": "guardduty_publishing_destination",
      "truncated": false
    },
    "links": {
      "self": "/v2/provider-docs/3255295"
    }
  }
}